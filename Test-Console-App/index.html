<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
        <title>JavaScript Decryption Test</title>
    </head>
    <body>
        .NET Core and JavaScript Encryption Decryption Library<br />(c) by Smart In Media, MIT License<br />
        <br />
        Let's assume, the JS now received the data from C#:<br />
        <br />We have: <br />
        Encrypted data in C# with concatenated base64 strings: uTkXNB+PSTjzwUCJbfAHVHd95YOlcJr38wbF08ZxqNw=:PNGRjWb5tOINneaVVf8+cw==:Aic+gosvLjTrCebzY8l/usTh+kWuE0v1xSWw7apYunI=
        <br />and the passphrase: This_is_my_password!
        <br />Please note that the C# side also has a password generator (PasswordGenerator.GenerateRandomPassword(20); for password length of 20 characters, you can define the character set)
        <br />
        <br />
        <strong><span id="output"></span></strong>
        <script type="text/javascript" src="../crypto-js.min.js"></script>
        <script type="text/javascript" src="./encryptionHandler.js"></script>
        <script type="text/javascript">

            // Test AES

            var encryptedBase64FromCSharp = "uTkXNB+PSTjzwUCJbfAHVHd95YOlcJr38wbF08ZxqNw=:PNGRjWb5tOINneaVVf8+cw==:Aic+gosvLjTrCebzY8l/usTh+kWuE0v1xSWw7apYunI=";
            var passPhrase = "This_is_my_password!";

            var eH = new encryptionHandler();
            

            var decryptedFromCSharp = eH.decrypt(encryptedBase64FromCSharp, passPhrase);

            var span = document.getElementById("output");
            var outputText = "The decrypted text from C#: " + decryptedFromCSharp;
            span.innerHTML = outputText;
            var encryptTextWithJs = eH.encrypt(decryptedFromCSharp, "This_is_my_password!");

            var decryptedTextWithJs = eH.decrypt(encryptTextWithJs, "This_is_my_password!");
            outputText += "<br>And now this was encrypted and decrypted again with JS: " + decryptedTextWithJs;
            span.innerHTML = outputText;

            // Test Scrypt
            outputText += "<br><br>Testing Scrypt<br> with password = 'This_is_my_password!', Salt = '1', N = ";



            var t0 = (new Date()).getTime();
            scrypt(password, salt, N = 16384, r = 8, p = 1, dkLen = 32, function(error, progress, key) {

                if (error) {
                    outputText += "Cancelled: " + parseInt(100 * progress) + "% done";

                } else if (key) {
                    key = new buffer.SlowBuffer(key);

                    var keyString = ":s2:" + N.toString() + ":" + r.toString() + ":" + p.toString() + ":" + btoa(salt.toString());
                    keyString += ":" + btoa(key);
                    

                    outputText += "<br>The output of Scrypt is: " + keyString;


                    console.log("<br>Generated: " + key.toString('hex'));
                    outputText += "<br>Complete: " + (((new Date()).getTime() - t0) / 1000) + ' seconds';
                    span.innerHTML = outputText;

                }

                if (error || key) {
                    
                } else if (done) {


                    return true;
                }

                get('progressBar').style.width = parseInt(100 * progress) + '%';
                get('progressAmount').innerHTML = parseInt(100 * progress) + '%';
            });

        } else if (done === false) {
            done = true;
        }
    };



        </script>

    </body>
</html>