<!DOCTYPE html>

<html lang="en" xmlns="http://www.w3.org/1999/xhtml">
    <head>
        <meta charset="utf-8" />
        <title>JavaScript Decryption Test</title>
    </head>
    <body>
        <h1>Test for encryption/decryption between JS and C#</h1>
        <p>
            .NET Core and JavaScript Encryption Decryption Library<br />(c) by Smart In Media, MIT License<br />
            <br />
            Let's assume, the JS now received the data from C#:<br />
            <br />We have: <br />
            Encrypted data in C# with concatenated base64 strings: uTkXNB+PSTjzwUCJbfAHVHd95YOlcJr38wbF08ZxqNw=:PNGRjWb5tOINneaVVf8+cw==:Aic+gosvLjTrCebzY8l/usTh+kWuE0v1xSWw7apYunI=
            <br />and the passphrase: This_is_my_password!
            <br />Please note that the C# side also has a password generator (PasswordGenerator.GenerateRandomPassword(20); for password length of 20 characters, you can define the character set)
            <br />
            <br />
            <strong><span id="output"></span></strong>


            <br />
            <br />
        </p>
        <h1>Test for hashing with Scrypt</h1>
        <p>
            There is also an implementation for Scrypt. Scrypt is a new(er) way to hash passwords more securely, if
            <br/>you want to store them in your database, etc. Scrypt takes longer to hash - you can set it according
            <br/>to hardware performance. I. e. you can define that hashing a password takes a second on a fast machine.
            <br/>The purpose of that is to make brute force (and dictionary) attacks considerably harder for attackers.
            <br/>
            <strong>Progress: <span id="progress"></span></strong>
            <br/>
            
            <strong><span id="outputScrypt"></span></strong>
        </p>
        <script type="text/javascript" src="./crypto-js.min.js"></script>
        <script type="text/javascript" src="./scrypt.min.js"></script>

        <script type="text/javascript" src="./encryptionHandler.js"></script>
        <script type="text/javascript" src="./scryptHandler.js"></script>

        <script type="text/javascript">

            // Test AES

            var encryptedBase64FromCSharp =
                "uTkXNB+PSTjzwUCJbfAHVHd95YOlcJr38wbF08ZxqNw=:PNGRjWb5tOINneaVVf8+cw==:Aic+gosvLjTrCebzY8l/usTh+kWuE0v1xSWw7apYunI=";
            var passPhrase = "This_is_my_password!";

            var eH = new encryptionHandler();


            var decryptedFromCSharp = eH.decrypt(encryptedBase64FromCSharp, passPhrase);

            var spanEnc = document.getElementById("output");
            

            var outputText = "The decrypted text from C#: " + decryptedFromCSharp;
            spanEnc.innerHTML = outputText;
            var encryptTextWithJs = eH.encrypt(decryptedFromCSharp, "This_is_my_password!");

            var decryptedTextWithJs = eH.decrypt(encryptTextWithJs, "This_is_my_password!");
            outputText += "<br>And now this was encrypted and decrypted again with JS: " + decryptedTextWithJs;
            spanEnc.innerHTML = outputText;

            //
            // Test Scrypt
            //
            var outputText2 = "<br><br>Testing Scrypt<br> with password = 'This_is_my_password!' and salt = 'This_is_my_SALT!'";
            var password = "This_is_my_password!";
            var salt = "This_is_my_SALT!";
            var t0 = (new Date()).getTime(); //To measure time!
            /*
             You can add any of these options
            var options = 
                {
                      "salt": string, //(can be empty or null, then string is automatically created)
                      "cost": int, //(the "N" of scrypt, default is 16384)
                      "blockSize": int, // (the "r", default is 8)
                      "parallel": int, // (the "p", default is 1)
                      "derivedKeyLength": int // (default is 32)
                }
            */
            var sH = new scryptHandler();

            var options = { "salt": salt };
            var callback = function(error, progress, key) {
                if (error) {
                    outputText2 += "There was an error: " + error;
                }
                else if (key) {
                    outputText2 += "<br/>The key string for password " + password +" is: " + key;
                    outputText2 += "<br/>It is compatible with C# as long as you leave maxThreads in C# at null";
                    outputText2 += "<br>Execution time: " + (((new Date()).getTime() - t0) / 1000) + ' seconds';
                    var spanScrypt = document.getElementById("outputScrypt");
                    spanScrypt.innerHTML = outputText2;
                    sH.comparePasswordWithHash(password,
                        key,
                        function(isTheSame) {
                            if (isTheSame) {

                                var spanScrypt = document.getElementById("outputScrypt");
                                spanScrypt.innerHTML =
                                    spanScrypt.innerHTML + "<br/>Checking the password vs hash: matches!";

                            } else {
                                var spanScrypt = document.getElementById("outputScrypt");
                                spanScrypt.innerHTML =
                                    spanScrypt.innerHTML + "<br/>Checking the password vs hash: does not match!";

                            }
                        });

                }

                else if (progress) {
                    var spanProgress = document.getElementById("progress");

                    spanProgress.innerHTML = (((progress * 100).toFixed()).toString() + "%");
                }
                
            }

            sH.Hash(password, options, callback);

            //now testing the PW
            function testHash(password, hashString, callback) {

            }


        </script>

</body>
</html>